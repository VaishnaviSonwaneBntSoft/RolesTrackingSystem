<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add New Member</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body>
    <header>
        <div class="logo">Role Tracker</div>
        <nav>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="add-member.html">Members</a></li>
                <li><a href="add-role.html">Roles</a></li>
                <li><a href="#">Meetings</a></li>
                <li><a href="#">Reports</a></li>
                <li><a href="#">Settings</a></li>
            </ul>
        </nav>
        <div class="profile">
            <img src="images/profile.webp" alt="Profile">
            <div class="dropdown">
                <a href="Account.html">Account</a>
                <a href="#">Logout</a>
            </div>
        </div>
    </header>

    <div class="mx-3">

        <div class="container mt-5">
            <h2>Manage Member</h2>
            <form id="addMemberForm">
                <div class="mb-3">
                    <label for="firstName" class="form-label">First Name:</label>
                    <input type="text" class="form-control" id="firstName" name="firstName" required pattern="[A-Za-z]+"
                        title="First name should only contain letters.">
                    <div class="invalid-feedback">First name is required and should only contain letters.</div>
                </div>

                <div class="mb-3">
                    <label for="lastName" class="form-label">Last Name:</label>
                    <input type="text" class="form-control" id="lastName" name="lastName" required pattern="[A-Za-z]+"
                        title="Last name should only contain letters.">
                    <div class="invalid-feedback">Last name is required and should only contain letters.</div>
                </div>

                <div class="mb-3">
                    <label for="phoneNumber" class="form-label">Phone Number:</label>
                    <input type="tel" class="form-control" id="phoneNumber" name="phoneNumber" pattern="\d{10}"
                        title="Phone number should be exactly 10 digits." required>
                    <div class="invalid-feedback">Phone number is required and should contain exactly 10 digits.</div>
                </div>

                <div class="mb-3">
                    <label for="emailAddress" class="form-label">Email Address:</label>
                    <input type="email" class="form-control" id="emailAddress" name="emailAddress" required>
                    <div class="invalid-feedback">Please enter a valid email address.</div>
                </div>

                <div class="mb-3">
                    <label for="occupation" class="form-label">Occupation:</label>
                    <input type="text" class="form-control" id="occupation" name="occupation">
                </div>

                <div class="mb-3">
                    <label for="dateOfBirth" class="form-label">Date of Birth:</label>
                    <input type="date" class="form-control" id="dateOfBirth" name="dateOfBirth" required>
                    <div class="invalid-feedback">Member should be above 17 In age. Please enter valid birthdate</div>
                </div>

                <div class="mb-3">
                    <label for="dateOfJoining" class="form-label">Date of Joining:</label>
                    <input type="date" class="form-control" id="dateOfJoining" name="dateOfJoining"
                        min="<?php echo date('Y-m-d'); ?>">
                </div>

                <div class="mb-3">
                    <label for="isExMember" class="form-label">MemberShip</label>
                    <select class="form-select" id="isExMember" name="isExMember" required>
                        <option value="" disabled selected>Select an option</option>
                        <option value="false">Feb-July 2024</option>
                        <option value="true">Aug-Jan 2024</option>
                    </select>
                    <div class="invalid-feedback">Please select MembershipCycle</div>
                </div>

                <div class="mb-3">
                    <label for="isExMember" class="form-label">Is Ex-Member:</label>
                    <select class="form-select" id="isExMember" name="isExMember" required>
                        <option value="" disabled selected>Select an option</option>
                        <option value="false">No</option>
                        <option value="true">Yes</option>
                    </select>
                    <div class="invalid-feedback">Please select whether the member is an ex-member.</div>
                </div>

                <button type="submit" class="btn btn-primary">Submit</button>
            </form>

        </div>


        <script>
            document.querySelectorAll('input, select').forEach(field => {
                field.addEventListener('input', () => {
                    if (field.checkValidity()) {
                        field.classList.remove('is-invalid');
                    } else {
                        field.classList.add('is-invalid');
                    }
                });
            });

            document.getElementById('addMemberForm').addEventListener('submit', function (e) {
                e.preventDefault();

                const form = this;
                const formData = new FormData(this);
                const member = {};
                formData.forEach((value, key) => {
                    if (key === 'isExMember') {
                        member[key] = value === 'true';
                    } else if (key === 'phoneNumber') {
                        member[key] = value ? parseInt(value) : null;
                    } else {
                        member[key] = value || null;
                    }
                });

                member.deleted = false;

                if (validateForm(form)) {

                    fetch('http://localhost:8081/api/member', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(member),
                    })
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('Network response was not ok');
                            }
                            return response.json();
                        })
                        .then(data => {
                            console.log('Success:', data);
                            alert('Member added successfully!');
                            this.reset();
                        })
                        .catch((error) => {
                            console.error('Error:', error);
                            alert('Error adding member. Please try again.');
                        });
                }
            });

            function validateForm(form) {
                let valid = true;
                const fields = form.querySelectorAll('input, select');

                fields.forEach(field => {
                    if (!field.checkValidity()) {
                        valid = false;
                        field.classList.add('is-invalid');
                    } else {
                        field.classList.remove('is-invalid');
                    }
                });

               
                const phoneNumber = form.querySelector('#phoneNumber').value;
                if (phoneNumber.length !== 10 || isNaN(phoneNumber)) {
                    valid = false;
                    document.querySelector('#phoneNumber').classList.add('is-invalid');
                } else {
                    document.querySelector('#phoneNumber').classList.remove('is-invalid');
                }

            
                const namePattern = /^[A-Za-z]+$/;
                const firstName = form.querySelector('#firstName').value;
                const lastName = form.querySelector('#lastName').value;
                if (!namePattern.test(firstName) || !namePattern.test(lastName)) {
                    valid = false;
                    document.querySelector('#firstName').classList.add('is-invalid');
                    document.querySelector('#lastName').classList.add('is-invalid');
                } else {
                    document.querySelector('#firstName').classList.remove('is-invalid');
                    document.querySelector('#lastName').classList.remove('is-invalid');
                }

                const dobInput = form.querySelector('#dateOfBirth');
                const dobValue = new Date(dobInput.value);
                const today = new Date();
                const minAge = 17;
                const minDate = new Date(today.setFullYear(today.getFullYear() - minAge));

                if (dobValue > minDate) {
                    valid = false;
                    dobInput.classList.add('is-invalid');
                } else {
                    dobInput.classList.remove('is-invalid');
                }

                return valid;
            }
        </script>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
            crossorigin="anonymous"></script>

    </div>
</body>

</html>
